!function(a){"undefined"!=typeof define&&define.amd?define(a):window.acute=a()}(function(){function a(a){return a&&"object"==typeof a&&r.call(a)==o&&!b(a)}function b(a){return a&&"object"==typeof a&&"number"==typeof a.length&&r.call(a)==p||!1}function c(a){return a&&r.call(a)==q}function d(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a}function e(){return"$"+s++}function f(a,b,c,d){this.append=new Function("o, i","i."+c+" = i."+d+" = null; if ( !o."+a+" ) { o."+a+" = i; } if ( o."+b+" ) { o."+b+"."+d+" = i; i."+c+" = o."+b+"; } o."+b+" = i;"),this.prepend=new Function("o, i","i."+c+" = i."+d+" = null; if ( o."+a+" ) { o."+a+"."+c+" = i; i."+d+" = o."+a+"; } o."+a+" = i; if ( !o."+b+" ) { o."+b+" = i; }"),this.remove=new Function("o, i","if ( i."+c+" ) { i."+c+"."+d+" = i."+d+"; } if ( i."+d+" ) { i."+d+"."+c+" = i."+c+"; } if ( i === o."+a+" ) { o."+a+" = i."+d+"; } if ( i === o."+b+" ) { o."+b+" = i."+c+"; } i. "+c+" = i."+d+" = null;")}function g(a,b){this.name=a,this.rootElement=b||document.body,this.rootScope=new i,this.rootScope.$root=this.rootScope,this.rootScope.$app=this,this.directives=d({},x),k(this,this.rootScope,this.rootElement)}function h(){this.head=null,this.tail=null}function i(){this.$id=e(),this.$watcher=new h,this.$childHead=null,this.$childTail=null}function k(a,b,c){var d,e,f;if(c.hasChildNodes()){var g=[];for(d=0,e=c.childNodes.length;e>d;d++)g.push(c.childNodes[d]);for(d=0,e=g.length;e>d;d++){f=g[d];var h=f.nodeType;if(h===t){var i=l(a,b,f,f.attributes);i||k(a,b,f)}else h===v&&m(f,b)}}}function l(a,b,c,d){var e,f,g,h=$(c),i=!1;for(e=0,f=d.length;f>e;e++){g=d[e];var j=a.directives[g.name];j&&j.link(b,h,d)&&(i=!0)}return i}function m(a,b){var c=a.nodeValue,d=function(){a.nodeValue=c.replace(/\{\{ *([\w\.]+) *\}\}/g,function(a,c){var d=b.$eval(c)||"";return"object"==typeof d&&(d=JSON.stringify(d)),d})};d(),c.replace(/\{\{ *([\w]+) *\}\}/g,function(a,c){b.$watch(c,d)})}var n={},o="[object Object]",p="[object Array]",q="[object Function]",r=Object.prototype.toString;n.isPlainObject=a,n.isArray=b,n.extend=d;var s=0,t=1,u=2,v=3,w=8,x={};g.prototype.directive=function(a,b){this.directives[a]=b},n.app=function(a,b){return new g(a,b)};var y=new f("head","tail","prev","next");h.prototype.watch=function(a,b,c){{var d={obj:a,field:b,handler:c};a&&a[b]}return y.append(this,d),function(){y.remove(this,d)}},h.prototype.digest=function(){for(var a=this.head;a;){var b=a.obj[a.field],c=JSON.stringify(b);(b!==a.lastValue||c!==a.lastJson)&&(a.handler(b,a.lastValue),a.lastValue=b,a.lastJson=c),a=a.next}},h.prototype.poll=function(a){if(a=a||1e3,this.pollIntervalId&&(clearInterval(this.pollIntervalId),this.pollIntervalId=nul),a>0){var b=this;this.pollIntervalId=setInterval(function(){b.digest()},a)}return this.digest(),this};var z=n.parseExpr=function(){function d(a){if(q[a])return q[a];var b=e(a),c=f(b);return q[a]=c,c}function e(a){function b(){h=!0,i=d}function c(b){h=!1;var c=a.substr(i,d-i);o.test(c)?e+=c:b?(e+="exec('"+c+"')",s=!0):(e+="get('"+c+"')",r=!0)}if(n.test(a))return{expr:a,buffer:"get('"+a+"')",hasGet:!0,hasExec:!1,hasAssign:!1,assignExpr:"assign('"+a+"')"};var d,e="",f=!1,g=!1,h=!1,i=0,k=!1,p=null,q=!1,r=!1,s=!1,t=!1;for(d=0,j=a.length;j>d;d++){var u=a[d];k?("\\"===u?q=!q:u!==p||q||(k=!1),e+=u):"'"===u||'"'===u?(k=!0,p=u,e+=u):"{"===u?(f=!0,g=!0,e+=u):":"===u&&g?(g=!1,e+=u):g||h||!l.test(u)?h?m.test(u)||(c("("===u?!0:!1),e+=u):h||(e+=u):b()}return h&&c(!1),e=e.replace(/get\('([^']+)'\)\s*=\s*([^;]+)/g,function(a,b,c){return t=!0,"assign('"+b+"', "+c+")"}),{buffer:e,hasGet:r,hasExec:s,hasAssign:t}}function f(a){var b=new Function("get, exec, assign","return "+a.buffer),d=function(e,f){var i=a.hasGet&&function(a){if(f){var b=g(f,a);if("undefined"!=typeof b)return b}return e?g(e,a):void 0},j=a.hasExec&&function(a){var b=f&&f[a];return c(b)?(k(e,a,d.onUpdate),b):(b=e&&e[a],c(b)?(k(e,a,d.onUpdate),b):p)},l=a.hasAssign&&function(a,b){h(e,a,b)};return b(i,j,l)};if(a.assignExpr){var e=new Function("assign",a.assignExpr);d.assign=function(a,b){var c=function(c){h(a,c,b)};e(c),k(a,prop,d.onUpdate)}}return d}function g(a,b){if(a)for(var c,d,e=b.split(".");e.length;){if(c=e.shift(),!e.length)return a[c];if(d=a[c],"undefined"==typeof d)return;a=d}}function h(c,d,e){if(c)for(var f,g,h=d.split(".");h.length;)f=h.shift(),h.length?(g=c[f],a(g)&&b(g)||(g=c[f]={},c=g)):c[f]=e}function k(a,b){if(a instanceof i){for(var c=a;c&&!c.hasOwnProperty(b);)c=c.$parent;c&&setTimeout(function(){c.$digest()},0)}}var l=/[a-z_$]/i,m=/[a-z_$0-9\.]/i,n=/^[a-z_$]+[\.a-z0-9_$]*$/i,o=/^true|false|null|undefined$/,p=function(){},q={};return d}(),A=new f("$childHead","$childTail","$prevSibling","$nextSibling");return i.prototype.$watch=function(a,b){this.$watcher.watch(this,a,b)},i.prototype.$digest=function(){this.$watcher.digest();for(var a=this.$childHead;null!==a;)a.$digest(),a=a.$nextSibling},i.prototype.$eval=function(a){var b=z(a)(this);return b;var c,d,e,f,g,h},i.prototype.$new=function(a){var b;if(a)b=new i;else{var c=function(){};c.prototype=this,b=new c,b.$id=e(),b.$watcher=new h}return b.$root=this.$root,b.$app=this.$app,b.$parent=this,b.$childHead=b.$childTail=null,A.append(this,b),b},i.prototype.$destroy=function(){console.debug("$destroy",this),this.$parent&&A.remove(this.$parent,this),this.$root=this.$app=this.$parent=null;for(var a=this.$childHead;a;)a.$destroy(),a=a.$nextSibling;for(var b in this)this.hasOwnProperty(b)&&(this[b]=null)},x["ng-show"]={link:function(a,b,c){var d=c["ng-show"].value,e=a.$eval(d);a.$watch(d,function(a){b.toggle(!!a)}),b.toggle(!!e)}},x["ng-hide"]={link:function(a,b,c){var d=c["ng-hide"].value,e=a.$eval(d);a.$watch(d,function(a){b.toggle(!a)}),b.toggle(!e)}},x["ng-click"]={link:function(a,b,c){var d=c["ng-click"].value;b.on("click",function(){a.$eval(d),console.log("click digest",a)})}},x["ng-repeat"]={link:function(a,c,d){var e=d["ng-repeat"].value,f=e.match(/for\s+(\w+)\s+in\s+(.+)/);if(f){var g=f[1],h=f[2],i=c.parent(),j=c.remove().clone(),l=[],m=function(c){var d,e;for(d=0,e=l.length;e>d;d++)l[d].$destroy();l=[],i.children().off().remove();var f,h;if(b(c))for(d=0,e=c.length;e>d;d++){f=c[d],h=j.clone().appendTo(i);var m=a.$new();m[g]=f,l.push(m),k(a.$app,m,h[0])}};a.$watch(h,m)}return!0}},n});